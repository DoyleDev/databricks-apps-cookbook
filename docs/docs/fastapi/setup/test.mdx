---
sidebar_position: 2
---

# Test a FastAPI App

This recipe demonstrates how to test FastAPI applications using pytest.  

The tests we have included do not require the FastAPI application to be running, but we provide examples of [dependency injection](https://docs.pytest.org/en/4.6.x/fixture.html#fixtures-a-prime-example-of-dependency-injection) when not connected to a live environment.


## Code snippets

#### Pytest Setup

```ini title="pytest.ini"
[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
python_classes = Test*
addopts = -v 
```

```python title="tests/conftest.py"
import pytest
from fastapi.testclient import TestClient

from app import app

@pytest.fixture
def client():
    """Create a test client for the FastAPI application."""
    return TestClient(app)
```

#### Tests per FastAPI code

```python title="tests/test_app.py"
from fastapi import status

def test_root_endpoint(client):
    """Test the root endpoint returns the expected response."""
    response = client.get("/")
    assert response.status_code == status.HTTP_200_OK
    data = response.json()
    assert "app" in data
    assert "message" in data
    assert data["app"] == "Databricks FastAPI Example"
```

```python title="tests/v1/test_healthcheck.py"
from fastapi import status

def test_healthcheck(client):
    """Test the healthcheck endpoint."""
    response = client.get("/api/v1/healthcheck")
    assert response.status_code == status.HTTP_200_OK
    data = response.json()
    assert "status" in data
    assert data["status"] == "OK"
    assert "timestamp" in data
```

## Running Tests

```bash
# Run all tests
pytest

# Run specific tests
pytest tests/v1/test_healthcheck.py

# Run with coverage report
pytest --cov=app tests/
```

## Resources

- [FastAPI](https://pypi.org/project/fastapi/) - `fastapi`
- [pytest](https://pypi.org/project/pytest/) - `pytest`
- [pytest-cov](https://pypi.org/project/pytest-cov/) - `pytest-cov`
- [uvicorn](https://pypi.org/project/uvicorn/) - `uvicorn`

## Permissions

There are no permission restrictions to run local tests.

## Dependencies

```python title="requirements.txt"
fastapi
pytest
pytest-cov
uvicorn
``` 